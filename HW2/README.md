# ADL_HW2 - BERT for QA
Fine-tune BERT on the Chinese question answering task.

### Install
This project uses [PyTorch](https://pytorch.org/), [transformers](https://huggingface.co/transformers/installation.html). Go check them out if you don't have them locally installed.

``$ pip install torch torchvision``  
``$ pip install transformers``

### How to train
```
$ python3 train.py $1

arguments: 
    $1: train file (a json file)

example:
    $ python3 train.py train.json
```
#### Sample input
- A **json** file  
```
{
    'title': '国际足球联合会', 
    'id': '1002', 
    'paragraphs': [
        {
            'context': '國際足球總會是管理英式足球、室內五人足球和沙灘足球的國際管理機構，下轄211個會員協會。總部設於瑞士蘇黎世。現任會長為吉安尼·因凡蒂諾。國際足總負責組織世界重大足球賽事，最著名的是世界盃。國際足總首屆會長是羅伯特·格林。接替他的是英格蘭足總的丹尼爾·伯利·伍爾福爾。國際足總組織的首個大型賽事是1908年倫敦奧運會足球淘汰賽，比賽很成功，參賽的是各國的職業運動員，而此後的奧運會就限制職業球員參加，並對於球員健全的身體有嚴格的檢驗機制，曾在1912年禁止有割盲腸者加入。一戰時英格蘭、蘇格蘭、威爾斯和北愛爾蘭的足總退出了國際足總，聲明不願與敵人交手，後來又重新加入了。國際足總歷史藏品位於英國的國家足球博物館。2004年舉行了國際足球總會成立100周年紀念活動，2004年4月，該組織宣布在2003年至2006年期間總收入將達到16.4億美元，總利潤將達到1.44億美元。2004年5月20日，為了紀念國際足球總會誕生100周年，巴西國家足球隊與法國國家足球隊舉行了一場紀念賽，最終雙方以0-0握手言和。', 
            'id': '1002-1', 
            'qas': [
                {'id': 'e8bf3babc182c6deaaf608b40b3f9e6ad83ec480c2c1a19897242292', 'question': '組織世界盃的機構的主要據點在哪？', 'answers': [{'id': '1', 'text': '瑞士蘇黎世', 'answer_start': 48}], 'answerable': True}, 
                {'id': 'bdbd53623618f7c7385d9d726de03bc3b578dc8d3cd5bb950bfe60f2', 'question': '奧運在甚麼時候割盲腸者的參賽會被拒絕？', 'answers': [{'id': '1', 'text': '1912年', 'answer_start': 220}], 'answerable': True}, 
                {'id': '1b57af7395961be479dbce88c0500dc609b57bd5bddeff490b3c3999', 'question': '為紀念國際足球總會誕生100周年的巴西跟法國國家足球隊紀念賽結果分數為？', 'answers': [{'id': '1', 'text': '0-0', 'answer_start': 444}], 'answerable': True}
            ]
        }, 
        {
            'context': '國際足總基於瑞士法律成立，總部位於蘇黎世。其最高權力機構是國際足總議會，由各成員國代表組成。只有議會有權修訂國際足總章程。議會每年開會一次決定各項事務，確認年報，批准新會員，在世界盃舉辦的次年選舉國際足總會長、秘書長和其他國際足總理事會成員，每個國家足總有一票的投票權。國際足總會長和秘書長是國際足球總會主要官員，負責日常事務管理，下轄的秘書辦公室有211名成員。國際足球總會執行委員會的會長是國際足總會長，在國際足總議會不召開的時候決定各項事務。國際足球總會還有一些其他的組織，包括金融委員會、紀律委員會、裁判委員會等。除去這些，還有六個被國際足球總會認證的管理各大洲足球聯盟或協會，他們分別是亞洲足球聯盟：亞足協有47個會員，而北馬里亞納群島並未加入國際足球總會，澳大利亞在2006年加入亞足協；非洲足球聯盟：非足協有54個正式會員和2個準會員，2個準會員均未加入國際足球總會；中北美洲及加勒比海足球聯盟：中北美洲及加勒比海足球聯盟有41個會員，但其中有6個不是國際足球總會成員，蓋亞那、法屬蓋亞那和蘇利南在南美，但其足總屬於中北美洲及加勒比海足球聯盟，法屬蓋亞那足總不是國際足球總會成員；南美洲足球聯盟：南美洲只有10個會員，是六個協會中成員最少而平均水平最高的協會；大洋洲足球聯盟：大洋洲足總有14個會員，但其中有3個不是國際足球總會成員；歐洲足球總會：歐足總共有55個成員，2016年5月，國際足總第66屆大會上正式投票通過了科索沃和直布羅陀加入國際足總的決議。跨洲國家俄羅斯、土耳其和哈薩克斯坦的足總都是歐足總成員，以色列地理位置屬亞洲，因政治原因加入歐足總。', 
            'id': '1002-2', 
            'qas': [
                {'id': '877640a33e33a493c41394b53a7f246920e8ea889347c616646817b6', 'question': '國際足總議會中在表決時每一國可以投幾票？', 'answers': [{'id': '1', 'text': '一', 'answer_start': 128}], 'answerable': True}, 
                {'id': 'bfb58764200124d87b68a412905fbc06a20e0802ac5dbb4246bbb136', 'question': '在亞洲中什麼國家有加入亞足協但未加入國際足球總會？', 'answers': [{'id': '1', 'text': '北馬里亞納群島', 'answer_start': 316}], 'answerable': True}, 
                {'id': '43ee9ed0460993072c5fc95e9ad9379056495ec92e6a79eb187979df', 'question': '哪一個地區的足球總會有3個會員國不是國際足球總會的會員國？', 'answers': [{'id': '1', 'text': '大洋洲', 'answer_start': 545}], 'answerable': True}, 
                {'id': 'bdfef6e1f68c7322350ddfd0aaf1edee3a7f7ce15dbd48910c806eb9', 'question': '國際足總會長布拉特表示是哪一區的球員讓他從反對門線技術轉而支持？', 'answers': [{'id': 1, 'text': '', 'answer_start': -1}], 'answerable': False}
            ]
        }
}
```
#### Sample output
- A model file: ``ckpt20.0.pt``

### How to test
```
$ python3 test.py $1 $2

arguments: 
    $1: test file (a json file)
    $2: output file (a json file)

example:
    $ python3 test.py test.json output.json
```
#### Sample input
- A **json** file  
```
{
    {'title': '馬祖列島', 
    'id': '1149', 
    'paragraphs': [
        {
            'context': '威武陳元帥廟位於西莒島青帆村。主祀陳元帥，神諱陳湯銘，為長樂鶴上人，以昭穆推算為玉溪陳氏第25世。相傳其急公好義，誅惡官，攜妹出海逃亡，遭水軍追捕，不願被俘而自沉於海，大體漂至白犬島，島民因其靈驗事蹟遂立廟奉祀。原名「威武陳將軍」，後傳受封為元帥，今稱「威武陳元帥」。其分靈至福建長樂、浙江大陳，後隨大陳移民傳自海內外，故此廟具有祖廟之地位，譽為「西莒之光」。東湧燈塔於西元1904年建成，由英國人設計、監造，塔高三層，由塔身、塔燈及塔頂等三部分組成。塔身由一公尺厚的紅磚組成，塔燈為鑄鐵構造。燈塔面向台灣海峽，建在東引島東北世尾山的懸崖之上，其造型及附屬房舍均承襲十八世紀英式建築的簡潔、優雅風格，素有「東引別墅」之美名。', 
            'id': '1149-13', 
            'qas': [
                {'id': 'd0947f97ae709964571595d1c1c15260274588f6f75a5c21d86b0039', 'question': '主要祭祀玉溪陳氏第25世的寺廟建於哪邊？'}, 
                {'id': 'ddf2aa20f0f6294aab958779c13f04716a61990fb7cbcc0c03248564', 'question': '威武陳元帥廟中主要祭祀的人是怎麼死的？'}, 
                {'id': '8fad127e006318841bcfdea2992aca9db6f21337543df752db4d1a95', 'question': '擁有「東引別墅」別名的建築是由哪一國人設計的？'}
            ]
        }, 
        {
            'context': '烈女義坑有個傳說，為清朝末年，一漁人遭海盜殺害，漁人之妻不願受辱，在此跳崖自殺，後人感念烈女殉節義舉，乃命名為烈女義坑。山崖距海高達數十丈，氣勢奇偉，是拍照留念的最佳景點之一。一線天位於烈女義坑不遠的軍事據點，在兩垂直相臨的山崖中，軍事坑道靠一座水泥橋相連，橋面距海面數十丈，氣勢懾人。旅客參觀一線天之前，須先前往東引遊客服務中心申請參觀證，經衛兵陪同下，前往參觀、拍照。由於一線天目前仍屬重要軍事基地，除非經由地方軍事首長允許，一般旅客不可進入坑道內參觀。太白天聲位於東引燈塔下方海岸，指的是一處險峻尖聳的巨石，每到3至5月的霧季，煙霧朦朧的霧氣就會將石頭遮掩，若隱若現的朦朧美景，讓人彷彿置身太虛幻境中，因此有「太白天聲」之說。遊客可漫步至觀景台，清楚瞭望整個大自然渾然天成的秀麗景色。', 
            'id': '1149-14', 
            'qas': [
                {'id': '65e8da4656504b128c4af88922bd0acd07d985dd13ca41b85ae68a49', 'question': '烈女義坑的生成與何時發生的事件有關？'}, 
                {'id': '366f1e1a4f8f1acd7fc54961e3b93c5cdd0d90dcee63d6e9d2860575', 'question': '為何遊客要進入一線天參觀必須要經過申請或是地方軍事首長允許？'}, 
                {'id': 'd6c649b24dffcc89dd64f3d6b47481468b6490d97e7fd5ae1ee71375', 'question': '有「太白天聲」的稱號的地方由什麼東西組成？'}
            ]
        }, 
        {
            'context': '根據清初《使琉球記》中記載，宋朝福建湄洲的孝女林默娘廿八歲時，因父兄駕船駛至閩江口海域，突遇巨風大浪，船毀人溺，媽祖得知，飛身入海拯救父兄，因而溺斃罹難，媽祖遺體當年隨海漂流至閩江口附近的小島，被漁民打撈上岸，並將媽祖埋葬在海岸邊。湄洲鄉親不見媽祖下落，認為她羽化昇天成仙，遂建湄洲媽祖廟作為紀念。馬祖人則認為，媽祖葬於現今馬祖南竿馬港天后宮宮內的靈穴石棺中，且興廟供奉，相傳至今。這個島因而被稱為媽祖島，爾後又改為馬祖。馬祖地名因此而來，媽祖也成為馬祖居民最重要的信仰。馬祖列島北起東引鄉北岸；南到莒光鄉林拗嶼南岸；極東東引鄉世尾山東岸；極西為南竿鄉津沙村西岸。馬祖距離臺灣島114海里、離金門152海浬、澎湖180海里與閩江口相距約15公里，離福建北茭半島約9.25公里。列島的陸域面積為29.6平方公里，全縣各島海岸線總長為138公里。', 
            'id': '1149-2', 
            'qas': [
                {'id': '0b6d4126d3de983807c8398d7e462c7f02f8474c6e0efec81b0a112d', 'question': '林默娘得年多少？'}, 
                {'id': '65e5e38764d1cec4cc71845cef98ca4c70cea0b95db641d066c22bbf', 'question': '馬祖的靈穴石棺內有哪一神明的屍體？'}, 
                {'id': '69d4ec82b047f14a0c4748826918857d1e99513085c88e39b4656e84', 'question': '哪一地區距離澎湖180海里而且與臺灣島之距離和金門之距離相差38海里？'}
            ]
        }, 
        {
            'context': '馬祖列島的地質條件上為花崗岩錐狀島嶼，地勢起伏大且陡峭。北竿島的壁山標高291.7公尺，為馬祖列島第一高峰。南竿第一高峰是雲台山，標是246.4公尺，已列為台灣小百岳之一。馬祖列島的地形多谷地、灣澳，海岸地區花崗質岩石，受風化及波浪的侵蝕作用，多崩崖、險礁、海蝕洞、海蝕門等地形，部分灣澳地區經過沖積與堆積作用形成沙灘、礫石灘、卵石灘。全縣4鄉只有東引沒有沙灘。馬祖列島的行政區劃上，東莒、西莒原屬於長樂，東引、西引原屬於羅源。由於內戰等重大變故，1956年7月福建省政府在國防部撤銷「福建省第一區行政督察專員公署」後，決定將上述各地悉數劃入連江縣，代管至今。', 
            'id': '1149-3', 
            'qas': [
                {'id': '5359c674d1427b1da3615b913c8abcd0fa831f6ecf2104f3e552521a', 'question': '馬祖列島這一地區的哪一個地方是最高的？'}, 
                {'id': '577c4250d88a4e10f9d1437c2b5b308baa99bc614b3bc70ead747156', 'question': '馬祖列島的地形中有很多崩崖與險礁之成因統稱為什麼？'}, 
                {'id': '8d239bfa731799cca5b934b889a6f433e7a1c36b90dd43b018006e05', 'question': '福建省第一區行政督察專員公署在何時被撤銷？'}, 
                {'id': '20b4fcbe7a5f2faf43e884b99b5037c5f34e231e9a9eed6137162495', 'question': '主要祭祀玉溪陳氏第25世的寺廟建於哪邊？'}
            ]
        }, 
        {
            'context': '馬祖地區屬亞熱帶海洋性氣候，四季分明，冬冷潮濕，春夏交際多霧，秋天氣候平均較為穩定。馬祖的緯度略高於台灣北部，惟因靠近中國大陸的大陸型氣候，氣溫比台北低，年平均溫度為攝氏18.6度，早晚溫差亦大，每年氣溫12月至2月間最低，3月份以後慢慢上升；7、8月氣溫最高，月平均溫度在29度左右，此後逐漸下降，2月份月均溫最低，僅10度左右。風速在10月至翌年3月間，大陸冷氣團南下，有強烈東北季風吹襲，故風速最大；尤其是3至5月間，開始吹南風形成多雲霧的天氣，即為平流霧。每年春天，南風從台灣海峽帶來暖濕空氣，和氣溫較低的馬祖地面、水域接觸，便形成濃霧。平流霧的厚度可達七、八百公尺以上，天氣好時的日間太陽輻射最多只能消除雲層頂部一部分，因此；如果平流霧歷久不散，能見度驟降，這就是為何馬祖地區的航班常常於此季節飛飛停停的原因。馬祖地區全年降雨量多集中於4至5月，颱風則多發生於7、8月，年平均雨量約1060公釐，不到台灣雨量的一半，雨季集中在4至9月的梅雨季及颱風季。', 
            'id': '1149-4', 
            'qas': [
                {'id': 'db79c0edceb797e239e0752a4890610a1fa5af05110c8faf4e7b5d10', 'question': '在什麼時間點去馬祖地區可以感受到較穩定的氣候？'}, 
                {'id': '7cf5d61e98c177f230e9108b779b7c48837940ce306ba2805ed31d2a', 'question': '為何馬祖地區會在10月至隔年3月間風速最大？'}, 
                {'id': '3da05870ca952a2480f2e9c5b2616ce53cd6379dfdfc71c5cf4f9176', 'question': '台灣的年平均雨量至少有多少的兩倍？'}
            ]
        }
    ]}
}
```

#### Sample output
- A **json** file
```
{
    "d0947f97ae709964571595d1c1c15260274588f6f75a5c21d86b0039": "西莒島青帆村",
    "ddf2aa20f0f6294aab958779c13f04716a61990fb7cbcc0c03248564": "陳元帥",
    "8fad127e006318841bcfdea2992aca9db6f21337543df752db4d1a95": "英國",
    "65e8da4656504b128c4af88922bd0acd07d985dd13ca41b85ae68a49": "清朝末年",
    "366f1e1a4f8f1acd7fc54961e3b93c5cdd0d90dcee63d6e9d2860575": "一線天目前仍屬重要軍事基地",
    "d6c649b24dffcc89dd64f3d6b47481468b6490d97e7fd5ae1ee71375": "巨石",
    "0b6d4126d3de983807c8398d7e462c7f02f8474c6e0efec81b0a112d": "廿八歲",
    "65e5e38764d1cec4cc71845cef98ca4c70cea0b95db641d066c22bbf": "媽祖",
    "69d4ec82b047f14a0c4748826918857d1e99513085c88e39b4656e84": "馬祖",
    "5359c674d1427b1da3615b913c8abcd0fa831f6ecf2104f3e552521a": "北竿島",
    "577c4250d88a4e10f9d1437c2b5b308baa99bc614b3bc70ead747156": "海岸地區花崗質岩石",
    "8d239bfa731799cca5b934b889a6f433e7a1c36b90dd43b018006e05": "1956年7月",
    "20b4fcbe7a5f2faf43e884b99b5037c5f34e231e9a9eed6137162495": "",
    "db79c0edceb797e239e0752a4890610a1fa5af05110c8faf4e7b5d10": "秋天",
    "7cf5d61e98c177f230e9108b779b7c48837940ce306ba2805ed31d2a": "大陸冷氣團南下，有強烈東北季風吹襲",
    "3da05870ca952a2480f2e9c5b2616ce53cd6379dfdfc71c5cf4f9176": "1060公釐"
}
```
